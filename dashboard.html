// js/dashboard.js
// Protege el dashboard, pinta el usuario y permite cerrar sesión

document.addEventListener('DOMContentLoaded', () => {
  // 1) Comprobar "sesión"
  const userEmail = sessionStorage.getItem('userEmail');
  const userName  = sessionStorage.getItem('userName');
  // (compat con lógicas antiguas)
  const loginToken = sessionStorage.getItem('loginToken');

  // Si no hay sesión, volver al login
  if (!userEmail || !loginToken) {
    window.location.href = '/';
    return;
  }

  // 2) Pintar saludo
  const userWelcomeEl = document.getElementById('userWelcome');
  if (userWelcomeEl) {
    const nombreMostrado = userName && userName.trim() ? userName : userEmail;
    userWelcomeEl.textContent = `Bienvenido, ${nombreMostrado}`;
  }

  // 3) Botón de logout
  const logoutBtn = document.getElementById('logoutBtn');
  if (logoutBtn) {
    logoutBtn.addEventListener('click', () => {
      sessionStorage.clear();
      window.location.href = '/';
    });
  }

  // (Opcional) ping de salud del backend
  // fetch('/api/health').catch(() => {});
});
